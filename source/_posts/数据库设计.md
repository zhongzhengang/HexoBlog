---
title: 数据库设计
categories:
    - 编程
        - 软件设计
tags:
    - 数据库
---


项目开发中，很多时候都会涉及到数据的存储，最简单的就是创建一个文件，然后对该文件进行内容的添加、更新和读取。如果数据内容比较复杂，很自然的就会转向数据库进行管理。

数据库设计是将数据库中的数据实体及这些数据实体之间的关系,进行规划和结构化的过程.

如果一个数据库没有进行一个良好的设计,那么这个数据库完成之后他的缺点是:

- 效率会很低
- 更新和检索数据时会出现很多问题

反之，一个数据库被尽心策划了一番,具有良好的设计,那他的优点是:

- 效率会很高.
- 便于进一步扩展.
- 使得应用程序的开发变得更容易

<!-- more -->

## 数据库的定义

数据库是专门管理数据的仓库，项目中我们遇到对数据库的描述，通常是对某些表的具体设计，比如一个学生表和课程表的设计如下：

表（一）Student(学生表)

| 字段名    | 数据类型   | 可否为空 | 含 义        |
| --------- | ---------- | -------- | ------------ |
| sno       | varchar(3) | 否       | 学号（主键） |
| sname     | varchar(8) | 否       | 学生姓名     |
| ssex      | varchar(2) | 否       | 学生性别     |
| sbirthday | date       | 可       | 学生出生年月 |
| sclass    | varchar(5) | 可       | 学生所在班级 |

表（二）Course(课程表）

| 属性名 | 数据类型    | 可否为空 | 含 义            |
| ------ | ----------- | -------- | ---------------- |
| cno    | varchar(5)  | 否       | 课程号（主键）   |
| cname  | varchar(10) | 否       | 课程名称         |
| tno    | varchar(3)  | 否       | 教工编号（外键） |

表（三）Score(成绩表)

| 属性名         | 数据类型     | 可否为空 | 含 义          |
| -------------- | ------------ | -------- | -------------- |
| sno            | varchar(3)   | 否       | 学号（外键）   |
| cno            | varchar(5)   | 否       | 课程号（外键） |
| degree         | decimal(3,0) | 可       | 成绩           |
| 主键：sno+ cno |              |          |                |

以上的表名称、字段属性名、类型以及约束条件，是对数据表的具体描述，属于数据库设计的物理阶段。



## 数据库设计的流程

数据表的诞生并不是随意设置的，比如上面的学生数据表为何包含5个字段？每个字段是如何考虑的？学生表和课程表为什么要拆开？成绩表和学生表是否可以合并？... 这些问题的详细答案，就涉及到数据库设计的流程。

从时间线上看，数据库设计可以划分为以下六个阶段：

### 需求分析阶段

“没有调查，就没有发言权”，数据库设计也是如此， 该阶段用于充分了解数据库的要求，可以采用各种调查方法进行分析，重点围绕“数据”和“处理”两方面，比如需要从数据库中存储的数据和性质、想要获得信息的内容、对处理的响应时间的要求、处理方式的要求(批处理 / 联机处理)等。除此之外，还有对数据库的安全性与完整性要求。

该阶段采用的工具通常是“**数据流图**”(DFD, Data Flow Diagram)和“**数据字典**”(DD, Data Dictionary)。数据流图反映了实际环境中的工作过程，采用简单的图形符号表示数据源、数据流、数据加工、和外部实体等，描述数据在整个系统中的流动和处理情况。数据字典是对数据流图中各个成分进行详细的解释说明，包括包括数据项字典、数据流字典、数据处理字典、数据存储字典。数据字典与数据流图是相互补充的，没有数据流图，数据字典难以发挥作用；没有数据字典，数据流图就不严格。



#### 数据流图

数据流图是[结构化分析方法](https://baike.baidu.com/item/结构化分析方法?fromModule=lemma_inlink)中使用的工具,它以图形的方式描绘数据在系统中流动和处理的过程，由于它只反映系统必须完成的逻辑功能，所以它是一种[功能模型](https://baike.baidu.com/item/功能模型?fromModule=lemma_inlink)。在结构化开发方法中，数据流图是需求分析阶段产生的结果。

**数据流图或数据流程图**（**Data Flow Diagram）**，缩写为**DFD**。数据流图DFD是描述[系统](https://baike.baidu.com/item/系统?fromModule=lemma_inlink)中数据流程的一种图形工具，它标志了一个系统的逻辑输入和逻辑输出，以及把逻辑输入转换逻辑输出所需的加工处理。

值得注意的是，数据流图不是传统的[流程图](https://baike.baidu.com/item/流程图?fromModule=lemma_inlink)或[框图](https://baike.baidu.com/item/框图?fromModule=lemma_inlink)，[数据流](https://baike.baidu.com/item/数据流?fromModule=lemma_inlink)也不是控制流。数据流图是从数据的角度来描述一个系统，而框图是从对数据进行加工的工作人员的角度来描述系统。

DFD显示系统将输入和输出什么样的信息，数据如何通过系统前进以及数据将被存储在何处。它不显示关于进程计时的信息，也不显示关于进程将按顺序还是并行运行的信息，而不像传统的关注控制流的结构化[流程图](https://baike.baidu.com/item/流程图?fromModule=lemma_inlink)，或者UML活动工作流程图，它将控制流和数据流作为一个统一的模型。

数据流图从数据传递和加工的角度，以图形的方式刻画数据流从输入到输出的移动变换过程。



##### 数据流图的分层

数据流图採用分层的形式来描写叙述系统数据流向，每一层次都代表了系统数据流向的一个抽象水平，层次越高，数据流向越抽象。高层次的DFD图中处理能够进一步分解为低层次、更具体的数据流图（DFD）。

数据流图分层 , 最上层是**顶层数据流图** , 第二层是 0 层数据流图 , ⋯⋯ , 最底层是**底层数据流图** ,

“顶层数据流图” 与 “底层数据流图” 之间是若干 中层数据流图 , 中层数据流图需要进行编号 , 从 0 开始编号 ;



###### 顶层数据流图

顶层数据流图中间的椭圆是需要开发的系统 , 周边的矩形表示的是外部实体人或组织 , 外部实体与系统之间 , 有数据传输关系;

一个形象的说明是多个人吃火锅 , 外层周边是人, 中心位置火锅是系统；

顶层数据流图能够表达的信息是非常有限的，其将整个系统，使用一个节点表示，其可以体现出系统与外界实体之间的交互，但是系统内部的情况，系统内部模块之间的数据交换是没有体现的；



###### 中层数据流图

将 “顶层数据流图” 进行细化，细化后的 0 层数据流图，与顶层数据流图比较没有变化的部分：外部实体，外部实体与系统之间的数据流，是没有变化的；

变化部分：有变化的部分是系统内部，系统内部进行了细化，原来系统是一个节点，在中层数据流图中，会将一个节点拆分成多个节点，这些节点就是系统中的数据处理部件，即加工；这些数据处理部件 ( 加工 ) 之间会有数据流的交互 。



###### 底层数据流图

针对每个加工节点，将其拆分，绘制其中的更详细的数据流转情况；

数据流图 ( DFD ) 分层是从 顶层 -> 中层 -> 底层，逐层进行分解，这种分解思路，与结构化的开发方法，是完全匹配的；

因此，数据流图是结构化开发方法中，最常用的工具；绘制数据流图时，要保证上一层数据流图与下一层数据流图保持平衡，这就是 数据流图平衡原则。



##### 概念符号



###### 数据流

数据流 : 数据流由一组固定成分的数据组成 , 表示数据的流向 ;

数据流命名 : 每个数据流都有一个命名 , 该命名表达了该数据流传输的数据的含义 ; 如在箭头上标注 “账号信息”，表示该数据流是传输账号信息的 , 表示数据的内容 ;

数据字典 : 数据流箭头上只标明了 “账号信息” , 没有具体的格式内容 , 是只有账号 , 还是有账号/密码/验证码等信息 , 这些数据详细格式 , 都在数据字典中定义 ;

符号表示 : 数据流使用箭头表示 , 箭头所指的方向 , 代表了数据流向 ;

![在这里插入图片描述](images/20201025114734825.png)

###### 加工 ( 核心 )

加工 : 描述 “输入数据流” 到 “输出数据流” 之间的变换 , 即对数据进行什么样的处理 , 使得 “输入数据流” 变为 “输出数据流” ;

主要操作 : 在程序中的体现是 处理 数据的过程 , 向 “加工” 中输入数据流后 , 将数据进行加工 , 处理 , 变换后 , 产生新的 “输出数据流” ;

符号表示 : 使用 圆形 / 圆角矩形 表示加工 ;

![在这里插入图片描述](images/20201025114759507.png)

###### 数据存储

数据存储 ( 文件 ) : 表示 暂时存储的数据 , 数据存储的粒度是以 表 为单位 ;

文件名称 : 每个 数据存储 ( 文件 ) 都有 名字 ;

方向 : 流向文件的数据流 表示 向文件内写入内容 , 从文件流出的数据流 表示 从文件读取内容 ;

符号表示 : 使用 双横线 / 半框形矩形 表示

![在这里插入图片描述](images/20201025114813410.png)

###### 外部实体

外部实体 : 软件系统之外的 人员 / 组织 ;

符号表示 : 矩形 ;

![在这里插入图片描述](images/20201025114834338.png)

###### 常见画法

常见两种数据流图元素的画法：

| 版本        | 加工                                                | 数据存储                                            | 外部实体                                            | 数据流                                              |
| ----------- | --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- |
| **Yourdon** | ![img](images/20201030135459552.PNG)                | ![img](images/20201030135522902.PNG)                | ![a](images/20201030135600904.PNG)                  | ![在这里插入图片描述](images/20201030135618738.PNG) |
| **Visio**   | ![在这里插入图片描述](images/20201030135900929.PNG) | ![在这里插入图片描述](images/20201030135937370.PNG) | ![在这里插入图片描述](images/20201030135911481.PNG) | ![在这里插入图片描述](images/202010301359501.PNG)   |



##### 具体使用

顶层图：对整个系统的抽象描述，只包括外部实体、加工和数据流。

<img src="images/数据流图-顶层图.jpg" alt="img" style="zoom: 50%;" />

​                                                                   图片来自《软件工程》

零层图：分解原来庞大的系统，增加数据存储和对加工、外部实体的编号。

<img src="images/数据流图-零层图.jpg" alt="img" style="zoom:50%;" />

​                                                                   图片来自《软件工程》

子图：对零层图进一步分解，按照编号给子图中的数据存储、外部实体、加工编号，这可以方便后续制作数据字典。

<img src="images/数据流图-子图.jpg" alt="img" style="zoom:50%;" />

​                                                                   图片来自《软件工程》

#### 数据字典

数据字典是对已经编号的各个成分进行解释说明，示例如下：

**数据项字典(I1-01~In-n)：**

给出数据描述的部分内容，对数据流图中的各个存储文件中的记录字段予以逐个定义

| 编号  | 名称     | 类型   | 长度 | 说明         | 备注 |
| ----- | -------- | ------ | ---- | ------------ | ---- |
| I1-01 | 用户密码 | 字符型 | 50   | 用户账号密码 |      |

**数据流字典(F1~Fn)：**

| 编号 | 名称     | 来源 | 去向 | 所含数据结构 | 说明                       |
| ---- | -------- | ---- | ---- | ------------ | -------------------------- |
| F1   | 用户信息 | S1   | D1   | 用户细节     | 用户提交注册表单的用户数据 |

**数据存储字典(D1~Dn)：**

| 编号 | 名称 | 插入数据流 | 输出数据流 | 内容       | 说明                   |
| ---- | ---- | ---------- | ---------- | ---------- | ---------------------- |
| D1   | 用户 | F1(S1-D1)  | F2(D1-S2)  | 编号、细节 | 用于存储有关用户的信息 |

**数据处理字典(P1~Pn)：**

| 编号 | 名称         | 来源 | 处理逻辑概括                   | 输出数据流 | 说明 |
| ---- | ------------ | ---- | ------------------------------ | ---------- | ---- |
| P1   | 登录用户数据 | F1   | 读入用户数据，写入用户文件中去 | F2         |      |



### 概念设计阶段

将得到的需求，抽象为概念模型。按照先局部E-R图，再全局E-R图的步骤来实现。

| 名称   | 表示方式 | 说明         |
| ------ | -------- | ------------ |
| 实体   | 矩形     |              |
| 联系集 | 菱形     |              |
| 属性   | 椭圆     | 下划线为主键 |
| 连接   | 线段     |              |

以一个购物网站为例，下面是一个简单的ER图模型：

![img](images/购物网站ER图模型.jpg)



### 逻辑设计阶段

将不同的概念模型，根据它们之间的联系，转变为关系模式。通常要求要满足第三范式。

范式(Normal Form)是由英国人 E.F.Codd（关系数据库的开创者）在上个世纪70年代提出，它是关系数据库理论的基础，也是我们在设计数据库结构过程中所要遵循的规则和指导方法。目前实际提出的有8种范式：1NF，2NF，3NF，BCNF，4NF，5NF，DKNF，6NF。各种范式呈递次规范，越高的范式数据库冗余越小，最低要求的范式是第一范式（1NF），在第一范式的基础上进一步满足更多规范要求的称为第二范式（2NF），其余范式以次类推。通常所用到的只是前三个范式：第一范式（1NF），第二范式（2NF），第三范式（3NF）。

**第一范式（1NF）**

强调的是**列的原子性**，即列不能够再分成其他几列。 比如一个表：联系人（姓名，性别，电话） ，如果电话只考虑一个手机号码，则它满足1NF。如果除了手机号码，还包括第二个手机号码，或者座机号码，则它不符合1NF。

**第二范式（2NF）**

在 1NF基础上，增加两部分内容，一是表必须有一个主键；二是没有包含在主键中的列必须完全依赖于主键，而不能只依赖于主键的一部分。比如一个订单明细表：【OrderDetail】（OrderID，ProductID，UnitPrice，Discount，Quantity，ProductName）。 我们知道在一个订单中可以包含多种产品，所以单单一个 OrderID 是不足以成为主键的，主键应该是（OrderID，ProductID）。显而易见 Discount（折扣），Quantity（数量）完全依赖（取决）于主键（OderID，ProductID），而 UnitPrice，ProductName 只依赖于 ProductID，所以 OrderDetail 表不符合 2NF。

可以把【OrderDetail】表拆分为【OrderDetail】（OrderID，ProductID，Discount，Quantity）和【Product】（ProductID，UnitPrice，ProductName）来消除原订单表中UnitPrice，ProductName多次重复的情况。

第二范式（2NF）要求实体的属性**完全依赖**于主关键字。所谓完全依赖是指不能存在仅依赖主关键字一部分的属性，如果存在，那么这个属性和主关键字的这一部分应该分离出来形成一个新的实体，新实体与原实体之间是一对多的关系。

**第三范式（3NF）**

在2NF基础上，任何非主属性不依赖于其它非主属性，消除传递依赖。

考虑一个订单表【Order】（OrderID，OrderDate，CustomerID，CustomerName，CustomerAddr，CustomerCity）主键是（OrderID）。 其中 OrderDate，CustomerID，CustomerName，CustomerAddr，CustomerCity 等非主键列都完全依赖于主键（OrderID），所以符合 2NF。不过问题是 CustomerName，CustomerAddr，CustomerCity 直接依赖的是 CustomerID（非主键列），而不是直接依赖于主键，它是通过传递才依赖于主键，所以不符合 3NF。

通过拆分【Order】为【Order】（OrderID，OrderDate，CustomerID）和【Customer】（CustomerID，CustomerName，CustomerAddr，CustomerCity）从而达到 3NF。

第二范式（2NF）和第三范式（3NF）的概念很容易混淆，区分它们的关键点在于：2NF需要判断非主键列是否完全依赖于主键，还是依赖于主键的一部分；3NF需要判断非主键列是直接依赖于主键，还是直接依赖于非主键列。



### 物理设计阶段

为给定的数据模型，选取合适的应用环境进行存储。根据关系数据库的存取方法和存储结构，按照需求分析中的处理时间和空间约束，确定数据库的物理设计。



### 实施阶段

按照逐步完善的方式，首先进行测试数据的载入和应用程序的调试，然后进行数据库的试运行，用于评价其功能和性能，最后分期分批组织数据入库。



### 运行和维护阶段

由于不可避免的软、硬件故障，还有使用人员的误操作，都有可能造成数据库的破坏，所以要做好数据库的定期转储，保证数据库的安全性和完整性。

以上六个阶段是整个数据库的整个生命周期，作为开发人员，往往只关注物理实现阶段，在小的项目中这样面向功能快速实现的需求，能够很快满足。但是在大型项目，或者项目迭代到更复杂的需求时，就需要从头详细关注数据库的设计，这样才能让开发更平稳有效的满足需求。



## 学习绘制E-R图

绘制E-R图首先要了解什么是实体、什么是属性、什么是联系。

**实体**是指现实世界中具有区分其他事物的特征或属性与其他实体有联系的实体，针对于数据库中的表而言实体是指表中一行一行特定数据，但我们在开发中,也常常把整个表称为一个实体。

**属性**可以理解为实体的特征，针对于数据库中的表而言实体是指表中的列。

**联系**是两个或多个实体之间的关联关系。

**实体关系图**:

<img src="images/数据库实体关系图图标.png" alt="在这里插入图片描述" style="zoom: 33%;" />



例：酒店管理系统E-R图

<img src="images/酒店管理系统E-R图.png" alt="在这里插入图片描述" style="zoom: 33%;" />

## 关联关系的类型

**一对一**：X中的一个实体最对与Y中的一个实体关联，并且Y中的一个实体最多与X中的一个实体关联。
例子：一个人只有一张身份证。

**一对多**：X中的一个实体可以与Y中的任意数量的实体关联；Y中的一个实体最多与X中的一个实体关联。
例子：一个班级有多名学生.

**多对一**：X中的一个实体最多与Y中的一个实体关联；Y中的一个实体可以与X中的任意数量的实体关联。
例子：客人与客房之间的关系,一个客人只能住一间客房。

**多对多**：X中的一个实体可以与Y中的任意数量的实体关联，反之亦然。
例子：学生和课程之间的关系，一个学生可以有多门课程，一门课程可以对应多名学生。

## 绘制数据库模型图

以酒店管理系统为例：

<img src="images/酒店管理系统模型图.png" alt="在这里插入图片描述" style="zoom: 50%;" />

## 三大范式

下面用容易理解的方式来阐释三大范式。

### 第一范式

目标是确保每列的原子性。如果每列都是不可再分的最小数据单元，则满足第一范式。

### 第二范式

第二范式在第一范式的基础上更进一层，其目标是确保表中的每列都和主键相关，也就是说在一个数据库表中，一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中。如果一个关系满足第一范式，并且除了主键以外的其他列都依赖与该主键，则满足第二范式。

### 第三范式

第三范式在第二范式的基础上更进一层，第三范式的目标是确保每列都和主键列直接相关，而不是间接相关。如果一个关系满足第二范式，并且除了主键以外的其他列都这能依赖于主键列，列和列之间不存在相互依赖关系，则满足第三范式。



**规范性和性能的关系**：为了满足三大范式，我们的数据操作性能会受到相应的影响，所以，在实际的数据库设计中，既要考虑三大范式，避免数据的冗余和各种数据操作异常；有要考虑到数据访问性能，有时，为了减少表间连接，提高数据库的访问性能，允许适当的数据冗余列，这可能是最合适的数据库设计方案。



## 参考资料

1、[数据库的设计（E-R图，数据库模型图，三大范式）](https://blog.csdn.net/panfelix/article/details/104039606)

2、[学习数据库有什么经典书籍？](https://www.zhihu.com/question/296449985/answer/1223688630)

3、[商品管理系统数据库设计--SQL Server](https://blog.csdn.net/Artificial_idiots/article/details/122963688?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166365269516800182780121%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166365269516800182780121&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-3-122963688-null-null.142^v47^pc_rank_34_default_3,201^v3^control_2&utm_term=%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1&spm=1018.2226.3001.4187)

4、[数据库设计的六个基本步骤](https://blog.csdn.net/yiminghd2861/article/details/115375681?ops_request_misc=&request_id=&biz_id=102&utm_term=%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-5-115375681.142^v47^pc_rank_34_default_3,201^v3^control_2&spm=1018.2226.3001.4187)

5、[数据库设计（一）——数据库设计](https://blog.csdn.net/liudongdong19/article/details/82225048?ops_request_misc=&request_id=&biz_id=102&utm_term=%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-4-82225048.142^v47^pc_rank_34_default_3,201^v3^control_2&spm=1018.2226.3001.4187)

6、[数据库设计步骤（超级详细）|数据库](https://blog.csdn.net/LLLLQZ/article/details/110231569?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166365269516800182780121%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166365269516800182780121&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-110231569-null-null.142^v47^pc_rank_34_default_3,201^v3^control_2&utm_term=%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1&spm=1018.2226.3001.4187)

7、[数据库：数据库设计（需求，设计，运行，维护）](https://blog.csdn.net/qq_42192693/article/details/109720940?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166365269516800182780121%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166365269516800182780121&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-109720940-null-null.142^v47^pc_rank_34_default_3,201^v3^control_2&utm_term=%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1&spm=1018.2226.3001.4187)

8、[数据库设计的那些事儿](https://zhuanlan.zhihu.com/p/476409578)

9、[百度百科-数据流图](https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE)

10、[数据库设计入门](https://cloud.tencent.com/developer/article/1055472)

11、[数据流图、数据字典的画法](https://blog.csdn.net/weixin_43645287/article/details/109380467?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164617874916780271932407%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=164617874916780271932407&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-109380467.pc_search_insert_ulrmf&utm_term=%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE&spm=1018.2226.3001.4187)

12、[数据流图](https://blog.csdn.net/shulianghan/article/details/109271777?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164617874916780271932407%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=164617874916780271932407&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-109271777.pc_search_insert_ulrmf&utm_term=%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE&spm=1018.2226.3001.4187)

